# å°çº¢ä¹¦å‘å¸ƒ API

ä¸€ä¸ªåŸºäº Python çš„å°çº¢ä¹¦è‡ªåŠ¨å‘å¸ƒ APIï¼Œæ”¯æŒéƒ¨ç½²åˆ° Vercel + Render å¹³å°ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
EasyGo_XHS_publish/
â”œâ”€â”€ app.py                 # å‘å¸ƒæœåŠ¡å™¨ï¼ˆVercelï¼‰
â”œâ”€â”€ requirements.txt       # å‘å¸ƒæœåŠ¡å™¨ä¾èµ–
â”œâ”€â”€ vercel.json           # Vercel é…ç½®
â”œâ”€â”€ README.md             # æœ¬æ–‡æ¡£
â”‚
â””â”€â”€ sign-server/          # ç­¾åæœåŠ¡å™¨ï¼ˆRenderï¼‰
    â”œâ”€â”€ sign_server.py    # ç­¾åæœåŠ¡å™¨ä¸»æ–‡ä»¶
    â”œâ”€â”€ requirements.txt  # ç­¾åæœåŠ¡å™¨ä¾èµ–
    â”œâ”€â”€ render.yaml       # Render é…ç½®
    â””â”€â”€ README.md         # ç­¾åæœåŠ¡å™¨æ–‡æ¡£
```

## âœ¨ ç‰¹æ€§

- ğŸš€ æ”¯æŒæ–‡å­—å’Œå›¾ç‰‡ç¬”è®°å‘å¸ƒï¼ˆæœ€å¤š9å¼ å›¾ç‰‡ï¼‰
- ğŸ” åŸºäº Cookie çš„èº«ä»½éªŒè¯
- âš¡ Serverless éƒ¨ç½²ï¼ŒæŒ‰éœ€ä»˜è´¹
- ğŸ”„ è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
- ğŸ“ å®Œæ•´çš„æ—¥å¿—è®°å½•
- ğŸ›¡ï¸ é”™è¯¯å¤„ç†å’Œå‚æ•°éªŒè¯
- ğŸ’¾ å›¾ç‰‡è‡ªåŠ¨ä¸‹è½½å’ŒéªŒè¯

## ğŸ—ï¸ éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     éƒ¨ç½²æ¶æ„å›¾                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ç”¨æˆ·è¯·æ±‚                                                â”‚
â”‚     â†“                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  å‘å¸ƒæœåŠ¡å™¨ (app.py)                 â”‚               â”‚
â”‚  â”‚  ğŸ“ Vercel (Serverless)              â”‚               â”‚
â”‚  â”‚  ğŸ“¦ æ¥æ”¶è¯·æ±‚ã€ä¸‹è½½å›¾ç‰‡ã€å‘å¸ƒç¬”è®°     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                â”‚ è°ƒç”¨ç­¾å API                            â”‚
â”‚                â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  ç­¾åæœåŠ¡å™¨ (sign_server.py)        â”‚               â”‚
â”‚  â”‚  ğŸ“ Render.com (æ–°åŠ å¡)              â”‚               â”‚
â”‚  â”‚  ğŸ“¦ ç”Ÿæˆè¯·æ±‚ç­¾å (x-s, x-t)         â”‚               â”‚
â”‚  â”‚  ğŸŒ Playwright + Chromium            â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### ç¬¬ä¸€æ­¥ï¼šéƒ¨ç½²ç­¾åæœåŠ¡å™¨åˆ° Render

```bash
# 1. è¿›å…¥ç­¾åæœåŠ¡å™¨ç›®å½•
cd sign-server

# 2. åˆå§‹åŒ– Gitï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git init
git add .
git commit -m "Deploy sign server"

# 3. æ¨é€åˆ° GitHub
git remote add origin https://github.com/ä½ çš„ç”¨æˆ·å/xhs-sign-server.git
git push -u origin main

# 4. åœ¨ Render.com è¿æ¥ä»“åº“å¹¶éƒ¨ç½²
#    - è‡ªåŠ¨æ£€æµ‹ render.yaml é…ç½®
#    - åœ°åŒºï¼šæ–°åŠ å¡ï¼ˆSingaporeï¼‰
#    - ç­‰å¾… 5-10 åˆ†é’Ÿå®Œæˆéƒ¨ç½²
```

**æˆ–è€…ä½¿ç”¨ Render æ§åˆ¶å°æ‰‹åŠ¨é…ç½®ï¼š**
- Build Command: `pip install -r requirements.txt && playwright install chromium && playwright install-deps`
- Start Command: `python sign_server.py`
- Region: Singapore
- Health Check: `/health`

### ç¬¬äºŒæ­¥ï¼šéƒ¨ç½²å‘å¸ƒæœåŠ¡å™¨åˆ° Vercel

```bash
# 1. åœ¨é¡¹ç›®æ ¹ç›®å½•
cd ..

# 2. éƒ¨ç½²åˆ° Vercel
vercel

# 3. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
vercel --prod
```

### ç¬¬ä¸‰æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

åœ¨ Vercel Dashboard æ·»åŠ ç¯å¢ƒå˜é‡ï¼š

| å˜é‡å | å€¼ | è¯´æ˜ |
|--------|-----|------|
| `XHS_SIGN_SERVER_URL` | `https://your-app.onrender.com` | Render ç­¾åæœåŠ¡å™¨åœ°å€ |

ç„¶åé‡æ–°éƒ¨ç½²ï¼š

```bash
vercel --prod
```

## ğŸ“ API ä½¿ç”¨

### å‘å¸ƒç¬”è®°

**è¯·æ±‚åœ°å€ï¼š** `POST /api/publish`

**è¯·æ±‚å¤´ï¼š**
```http
Content-Type: application/json
X-XHS-Cookie: a1=xxx; web_session=xxx; webId=xxx
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡ç¬”è®°",
  "content": "è¿™æ˜¯ç¬”è®°çš„æ­£æ–‡å†…å®¹",
  "image_urls": [
    "https://example.com/photo1.jpg",
    "https://example.com/photo2.jpg"
  ],
  "is_private": false
}
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "note_id": "65a3f2e1000000001f00f234",
  "note_url": "https://www.xiaohongshu.com/explore/65a3f2e1000000001f00f234"
}
```

### å¥åº·æ£€æŸ¥

**å‘å¸ƒæœåŠ¡å™¨ï¼š** `GET /api/health`

```bash
curl https://your-app.vercel.app/api/health
```

**ç­¾åæœåŠ¡å™¨ï¼š** `GET /health`

```bash
curl https://your-sign-server.onrender.com/health
```

## ğŸ”‘ è·å–å°çº¢ä¹¦ Cookie

1. è®¿é—® [å°çº¢ä¹¦ç½‘é¡µç‰ˆ](https://www.xiaohongshu.com)
2. ç™»å½•ä½ çš„è´¦å·
3. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰â†’ Network æ ‡ç­¾
4. åˆ·æ–°é¡µé¢ï¼Œç‚¹å‡»ä»»æ„è¯·æ±‚
5. æ‰¾åˆ° Request Headers ä¸­çš„ `Cookie` å­—æ®µ
6. å¤åˆ¶å®Œæ•´çš„ Cookie å€¼ï¼ˆå¿…é¡»åŒ…å« `a1`ã€`web_session`ã€`webId`ï¼‰

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

### ä½¿ç”¨ curl

```bash
curl -X POST https://your-app.vercel.app/api/publish \
  -H "Content-Type: application/json" \
  -H "X-XHS-Cookie: a1=xxx; web_session=xxx; webId=xxx" \
  -d '{
    "title": "æµ‹è¯•æ ‡é¢˜",
    "content": "è¿™æ˜¯ä¸€æ¡æµ‹è¯•ç¬”è®°",
    "image_urls": ["https://picsum.photos/800/600"]
  }'
```

### ä½¿ç”¨ Python

```python
import requests

url = "https://your-app.vercel.app/api/publish"
headers = {
    "Content-Type": "application/json",
    "X-XHS-Cookie": "a1=xxx; web_session=xxx; webId=xxx"
}
data = {
    "title": "æµ‹è¯•æ ‡é¢˜",
    "content": "è¿™æ˜¯ä¸€æ¡æµ‹è¯•ç¬”è®°",
    "image_urls": ["https://picsum.photos/800/600"]
}

response = requests.post(url, json=data, headers=headers)
print(response.json())
```

## ğŸ› å¸¸è§é—®é¢˜

### Q: éƒ¨ç½²ç­¾åæœåŠ¡å™¨å¤±è´¥

**A:** Render Free Plan å†…å­˜æœ‰é™ï¼Œé¦–æ¬¡éƒ¨ç½²éœ€è¦ 5-10 åˆ†é’Ÿå®‰è£… Playwrightã€‚å¦‚æœå¤±è´¥ï¼š
1. æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
2. å°è¯• "Clear build cache & deploy"
3. è€ƒè™‘å‡çº§åˆ° Starter Plan ($7/æœˆ)

### Q: Vercel æ— æ³•è¿æ¥ç­¾åæœåŠ¡å™¨

**A:** æ£€æŸ¥ï¼š
1. `XHS_SIGN_SERVER_URL` ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®
2. Render æœåŠ¡æ˜¯å¦å·²å¯åŠ¨ï¼ˆFree Plan ä¼šä¼‘çœ ï¼‰
3. å…ˆè®¿é—®ç­¾åæœåŠ¡å™¨ URL å”¤é†’æœåŠ¡

### Q: Cookie è¿‡æœŸæ€ä¹ˆåŠ

**A:** é‡æ–°è·å– Cookie å¹¶æ›´æ–°è¯·æ±‚å¤´ä¸­çš„ `X-XHS-Cookie`ã€‚

### Q: å›¾ç‰‡ä¸Šä¼ å¤±è´¥

**A:** ç¡®ä¿ï¼š
1. å›¾ç‰‡ URL å¯è®¿é—®
2. å›¾ç‰‡æ ¼å¼æ­£ç¡®ï¼ˆjpgã€pngã€webpï¼‰
3. è‡³å°‘æœ‰ä¸€å¼ å›¾ç‰‡

### Q: ç­¾åå¤±è´¥

**A:** ç­¾åæœåŠ¡å™¨å·²å†…ç½® 10 æ¬¡é‡è¯•ã€‚å¦‚æœä»ç„¶å¤±è´¥ï¼š
1. æ£€æŸ¥ç­¾åæœåŠ¡å™¨æ—¥å¿—
2. ç¡®è®¤ stealth.min.js å·²æˆåŠŸä¸‹è½½
3. å°è¯•é‡å¯ Render æœåŠ¡

## ğŸ’° è´¹ç”¨è¯´æ˜

| æœåŠ¡ | å¹³å° | å…è´¹é¢åº¦ | ä»˜è´¹æ–¹æ¡ˆ |
|------|------|---------|---------|
| å‘å¸ƒæœåŠ¡å™¨ | Vercel | å…è´¹ | $20/æœˆï¼ˆProï¼‰ |
| ç­¾åæœåŠ¡å™¨ | Render | 750å°æ—¶/æœˆï¼ˆä¼šä¼‘çœ ï¼‰ | $7/æœˆï¼ˆStarterï¼Œä¸ä¼‘çœ ï¼‰ |

**æ¨èé…ç½®ï¼š**
- æµ‹è¯•/ä½é¢‘ä½¿ç”¨ï¼šå…¨å…è´¹
- ç”Ÿäº§ç¯å¢ƒï¼šVercel Free + Render Starter = $7/æœˆ

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  Cookie**
2. **å®šæœŸæ›´æ–° Cookie**ï¼ˆCookie ä¼šè¿‡æœŸï¼‰
3. **é™åˆ¶ API è®¿é—®**ï¼ˆæ·»åŠ è®¤è¯æˆ– IP ç™½åå•ï¼‰
4. **ç›‘æ§è¯·æ±‚é¢‘ç‡**ï¼ˆé¿å…è¢«å°çº¢ä¹¦å°ç¦ï¼‰

## ğŸ“š æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Python 3.9+
- **Web æ¡†æ¶**: Flask 3.0
- **å°çº¢ä¹¦ SDK**: xhs 0.2.13+
- **æµè§ˆå™¨è‡ªåŠ¨åŒ–**: Playwright 1.40+
- **éƒ¨ç½²å¹³å°**: Vercel (å‘å¸ƒ) + Render (ç­¾å)

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [Vercel æ–‡æ¡£](https://vercel.com/docs)
- [Render æ–‡æ¡£](https://render.com/docs)
- [xhs åº“æ–‡æ¡£](https://github.com/ReaJason/xhs)
- [Playwright æ–‡æ¡£](https://playwright.dev/python/)

## âš ï¸ å…è´£å£°æ˜

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ï¼Œä½¿ç”¨è€…éœ€éµå®ˆå°çº¢ä¹¦å¹³å°çš„ç›¸å…³è§„å®šå’ŒæœåŠ¡æ¡æ¬¾ã€‚å› ä½¿ç”¨æœ¬é¡¹ç›®å¯¼è‡´çš„ä»»ä½•é—®é¢˜ï¼Œå¼€å‘è€…æ¦‚ä¸è´Ÿè´£ã€‚

## ğŸ“„ è®¸å¯è¯

MIT License

---

**Made with â¤ï¸ by EasyGo**
